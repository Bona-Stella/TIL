---
created: 2025-11-15 00:02
updated: 2025-11-15 00:02
status:
  - draft
tags:
source:
---
# 📝 TIL 2025-11-15 - Body 값은 한번만 읽어야 하는 이유

> **관련 주제:** [[MOC_TBD]] 

## 🚀 개요 및 핵심 (Summary)

`HttpServletRequest`의 Body(본문) 데이터는 WAS가 네트워크에서 받은 바이트 스트림을 기반으로 생성되며, 기본적으로 **스트림(Stream)의 특성**을 따르기 때문에 한 번 읽으면 데이터가 사라집니다.

---

## 📚 상세 내용 (Deep Dive)

## 🛑 Body는 한 번만 읽어야 하는 이유

Body는 스트림으로 남아있어 한 번 읽으면 소진됩니다.

- **효율성:** Body 데이터는 대용량 파일 등 길이가 **예측 불가능하게 길 수** 있습니다. 이를 무조건 메모리에 통째로 저장하면 서버 자원에 부담이 되므로, Servlet 표준은 필요할 때만 스트림으로 읽고 소진하는 방식을 채택했습니다.
-  **스트림의 본질:** 데이터 스트림은 **연속적인 흐름**을 의미합니다. 마치 수도꼭지에서 물이 흘러나오듯, 데이터를 읽는 순간 그 데이터는 소비되어 다시 되돌릴 수 없습니다.
    <br>
- **성능 최적화:** Body 데이터는 크기가 매우 클 수 있습니다(예: 파일 업로드). 이 데이터를 **매번 읽을 때마다 메모리에 복사**하여 보관한다면 **메모리 낭비와 성능 저하**가 심해집니다. 따라서 Java Servlet 표준은 메모리 효율성을 위해 **스트림 방식으로 한 번만 읽고 소비**하도록 설계되었습니다.
    <br>
- **실제 동작:** `request.getInputStream()`이나 `request.getReader()`를 호출하여 데이터를 읽으면, 내부적으로 WAS는 네트워크 버퍼에서 해당 바이트를 읽어 소진시키고 **스트림의 포인터를 끝으로 이동**시킵니다. 따라서 다시 읽으려고 하면 읽을 데이터가 남아있지 않게 됩니다.
    <br>
- **Controller 접근 전 조작:**
    
    - **원칙:** Body 값은 **Controller에서 `@RequestBody`를 통해 실제 비즈니스 로직에 사용될 때** 읽는 것이 원칙입니다.
        
    - **예외적인 경우:** Filter나 Interceptor에서 **보안 검증** (예: 메시지 무결성 확인)이나 **인증**을 위해 Body 내용을 _반드시_ 확인해야 할 때가 있습니다. 이 경우, 말씀드린 것처럼 `HttpServletRequest`의 스트림이 소진되어 Controller에서 읽을 수 없게 됩니다.
        
    - **해결책:** 이 문제를 해결하기 위해 **`ContentCachingRequestWrapper`** (Spring 내부 클래스 또는 사용자 정의 래퍼)와 같은 기술을 사용하여 **Body 스트림을 읽어 메모리에 복사**해 둔 다음, 나중에 Controller에서 복사본을 읽을 수 있도록 조치해야 합니다.

