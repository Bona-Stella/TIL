---
created: 2025-11-15 00:10
updated: 2025-11-15 00:10
status:
  - draft
tags:
source:
---
# 📝 TIL 2025-11-15 - PreAuthorize vs RequireRole

> **관련 주제:** [[MOC_TBD]] 

## 🚀 개요 및 핵심 (Summary)

### 💡 Spring Security와의 차이

- **Spring Security 기본 방식:** `@PreAuthorize("hasRole('MANAGER')")` 애노테이션을 Controller에 붙이면, **Spring Security의 인가 필터(FilterSecurityInterceptor)**나 **AOP 모듈**이 이를 읽고 **Filter 체인 단계에서** 자동으로 권한을 체크하고 차단합니다. **Interceptor가 필요 없습니다.**
    
- **Interceptor 활용 방식:** Spring Security를 사용하지 않거나, **DB 조회 등 비즈니스 로직과 결합된 복잡한 커스텀 권한 체크**가 필요할 때 Interceptor 방식을 사용합니다.

---

## 📚 상세 내용 (Deep Dive)

### 1. Controller에서의 Role 설정 (메타데이터)

개발자는 Controller 메서드에 **커스텀 애노테이션(Custom Annotation)**을 사용하여 해당 메서드가 요구하는 권한을 표시합니다. 이 애노테이션은 단순히 **메타데이터(metadata)** 역할을 할 뿐, 그 자체로 권한을 체크하지는 않습니다.

### 2. Interceptor에서의 체크 로직

DispatcherServlet이 요청을 처리할 때, HandlerMapping은 요청을 처리할 Controller 메서드를 찾습니다. Interceptor는 이 **Controller 메서드의 정보를 함께 전달**받습니다.

1. **메서드 정보 획득:** Interceptor의 `preHandle()` 메서드가 실행될 때, `Object handler` 파라미터를 통해 **실행될 Controller 메서드에 대한 정보**(`HandlerMethod` 객체)를 얻을 수 있습니다.
    
2. **애노테이션 확인:** Interceptor는 이 메서드 정보에서 **`@RequiresRole("MANAGER")`** 애노테이션이 붙어 있는지 확인합니다.
    
3. **권한 비교:** 애노테이션이 있다면, Interceptor는 현재 **로그인된 사용자 정보** (Filter에서 `request.getAttribute`로 저장된 User 객체 등)를 꺼내서, 이 사용자가 요구되는 Role(`"MANAGER"`)을 가지고 있는지 확인합니다.
    
4. **차단:** 권한이 부족하면 `false`를 반환하여 Controller 실행을 **차단**하고 로그인 페이지나 403 에러 페이지로 리다이렉트합니다.

## 🤝 노아와 아브람의 믿음 비교

| **구분**       | **노아의 믿음 (순종의 믿음)**                                             | **아브람의 믿음 (언약의 믿음)**                                            |
| ------------ | --------------------------------------------------------------- | --------------------------------------------------------------- |
| **믿음의 대상**   | **보이지 않는 심판의 경고**                                               | **보이지 않는 약속의 땅과 후손**                                            |
| **하나님의 명령**  | "너는 **방주**를 만들라" (심판으로부터의 구원)                                   | "**떠나라** 내가 보여줄 땅으로" (축복으로의 부르심)                                |
| **믿음의 형태**   | **행동하는 믿음** (준비와 건축)                                            | **이동하는 믿음** (떠남과 순그린방랑)                                         |
| **요구되는 희생**  | **시간과 노력:** 수십 년간 거대한 방주 건축. 세상의 조롱 감수.                         | **기득권 포기:** 고향, 친족, 아버지의 집, 경제적 안정 포기.                          |
| **결과**       | **가족 구원** 및 인류 역사 **보존**                                        | **큰 민족**의 조상, **복의 근원** (언약의 시작)                                |
| **히브리서의 평가** | "믿음으로 노아는 아직 보지 못하는 일에 경고하심을 받아 **경외함으로** 방주를 준비하여..." (히 11:7) | "믿음으로 아브라함은 부르심을 받았을 때에 **순종하여** 장래 기업으로 받을 땅에 나갈새..." (히 11:8) |