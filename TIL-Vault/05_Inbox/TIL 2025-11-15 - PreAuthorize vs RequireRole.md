---
created: 2025-11-15 00:10
updated: 2025-11-15 00:10
status:
  - draft
tags:
source:
---
# π“ TIL 2025-11-15 - PreAuthorize vs RequireRole

> **κ΄€λ ¨ μ£Όμ :** [[MOC_TBD]] 

## π€ κ°μ” λ° ν•µμ‹¬ (Summary)

### π’΅ Spring Securityμ™€μ μ°¨μ΄

- **Spring Security κΈ°λ³Έ λ°©μ‹:** `@PreAuthorize("hasRole('MANAGER')")` μ• λ…Έν…μ΄μ…μ„ Controllerμ— λ¶™μ΄λ©΄, **Spring Securityμ μΈκ°€ ν•„ν„°(FilterSecurityInterceptor)**λ‚ **AOP λ¨λ“**μ΄ μ΄λ¥Ό μ½κ³  **Filter μ²΄μΈ λ‹¨κ³„μ—μ„** μλ™μΌλ΅ κ¶ν•μ„ μ²΄ν¬ν•κ³  μ°¨λ‹¨ν•©λ‹λ‹¤. **Interceptorκ°€ ν•„μ” μ—†μµλ‹λ‹¤.**
    
- **Interceptor ν™μ© λ°©μ‹:** Spring Securityλ¥Ό μ‚¬μ©ν•μ§€ μ•κ±°λ‚, **DB μ΅°ν λ“± λΉ„μ¦λ‹μ¤ λ΅μ§κ³Ό κ²°ν•©λ λ³µμ΅ν• μ»¤μ¤ν…€ κ¶ν• μ²΄ν¬**κ°€ ν•„μ”ν•  λ• Interceptor λ°©μ‹μ„ μ‚¬μ©ν•©λ‹λ‹¤.

---

## π“ μƒμ„Έ λ‚΄μ© (Deep Dive)

### 1. Controllerμ—μ„μ Role μ„¤μ • (λ©”νƒ€λ°μ΄ν„°)

κ°λ°μλ” Controller λ©”μ„λ“μ— **μ»¤μ¤ν…€ μ• λ…Έν…μ΄μ…(Custom Annotation)**μ„ μ‚¬μ©ν•μ—¬ ν•΄λ‹Ή λ©”μ„λ“κ°€ μ”κµ¬ν•λ” κ¶ν•μ„ ν‘μ‹ν•©λ‹λ‹¤. μ΄ μ• λ…Έν…μ΄μ…μ€ λ‹¨μν **λ©”νƒ€λ°μ΄ν„°(metadata)** μ—­ν• μ„ ν•  λΏ, κ·Έ μμ²΄λ΅ κ¶ν•μ„ μ²΄ν¬ν•μ§€λ” μ•μµλ‹λ‹¤.

### 2. Interceptorμ—μ„μ μ²΄ν¬ λ΅μ§

DispatcherServletμ΄ μ”μ²­μ„ μ²λ¦¬ν•  λ•, HandlerMappingμ€ μ”μ²­μ„ μ²λ¦¬ν•  Controller λ©”μ„λ“λ¥Ό μ°Ύμµλ‹λ‹¤. Interceptorλ” μ΄ **Controller λ©”μ„λ“μ μ •λ³΄λ¥Ό ν•¨κ» μ „λ‹¬**λ°›μµλ‹λ‹¤.

1. **λ©”μ„λ“ μ •λ³΄ νλ“:** Interceptorμ `preHandle()` λ©”μ„λ“κ°€ μ‹¤ν–‰λ  λ•, `Object handler` νλΌλ―Έν„°λ¥Ό ν†µν•΄ **μ‹¤ν–‰λ  Controller λ©”μ„λ“μ— λ€ν• μ •λ³΄**(`HandlerMethod` κ°μ²΄)λ¥Ό μ–»μ„ μ μμµλ‹λ‹¤.
    
2. **μ• λ…Έν…μ΄μ… ν™•μΈ:** Interceptorλ” μ΄ λ©”μ„λ“ μ •λ³΄μ—μ„ **`@RequiresRole("MANAGER")`** μ• λ…Έν…μ΄μ…μ΄ λ¶™μ–΄ μλ”μ§€ ν™•μΈν•©λ‹λ‹¤.
    
3. **κ¶ν• λΉ„κµ:** μ• λ…Έν…μ΄μ…μ΄ μλ‹¤λ©΄, Interceptorλ” ν„μ¬ **λ΅κ·ΈμΈλ μ‚¬μ©μ μ •λ³΄** (Filterμ—μ„ `request.getAttribute`λ΅ μ €μ¥λ User κ°μ²΄ λ“±)λ¥Ό κΊΌλ‚΄μ„, μ΄ μ‚¬μ©μκ°€ μ”κµ¬λλ” Role(`"MANAGER"`)μ„ κ°€μ§€κ³  μλ”μ§€ ν™•μΈν•©λ‹λ‹¤.
    
4. **μ°¨λ‹¨:** κ¶ν•μ΄ λ¶€μ΅±ν•λ©΄ `false`λ¥Ό λ°ν™ν•μ—¬ Controller μ‹¤ν–‰μ„ **μ°¨λ‹¨**ν•κ³  λ΅κ·ΈμΈ νμ΄μ§€λ‚ 403 μ—λ¬ νμ΄μ§€λ΅ λ¦¬λ‹¤μ΄λ ‰νΈν•©λ‹λ‹¤.